---
title: "Clutch Work"
author: "Othon Hamill"
date: "October 24, 2018"
output: word_document
---

```{r}
#########################TO DO LIST############################
#Weights is the current issue. Whether clutch play and serves are equally valued as well as the actual values for clutch, null, and choke

#How are we going to deal with deuce points being both hold and break? Right now I'm including them in both, but we could just add another category since it's such a higher stress situation than a normal break or hold opprotunity

#How are we going to deal with returns hit into the net? 
```

```{r}
#call our necessary libraries
library(alr3)
library(MASS)
library(dplyr)
```

pservingonly function filters out opponents, leaving just BYU serving
```{r}
pservingonly<-function(rawdata){
  joint<-filter(rawdata,rawdata$server=="P")
}
```

highpressure function keeps only possible clutch points (a break or hold point)
```{r}
highpressure<-function(rawdata){
  #just clutch points, no sorting for server
hp<-rbind(
    rawdata[(rawdata$player.points == 0 & rawdata$opp.points == 3),],
    rawdata[(rawdata$player.points == 1 & rawdata$opp.points == 3),],
    rawdata[(rawdata$player.points == 2 & rawdata$opp.points == 3),],
    rawdata[(rawdata$player.points == 3 & rawdata$opp.points == 3),],
    rawdata[(rawdata$player.points == 3 & rawdata$opp.points == 2),],
    rawdata[(rawdata$player.points == 3 & rawdata$opp.points == 1),],
    rawdata[(rawdata$player.points == 3 & rawdata$opp.points == 0),])
  return(hp)
}
```

lowpressure function keeps everything but clutch points
```{r}
lowpressure<-function(rawdata){
  #just clutch points, no sorting for server
lp<-rawdata[(rawdata$player.points != 3 & rawdata$opp.points != 3),]
  return(lp)
}
```

acefilter: Returns all aces in a given dataset
```{r}
acefilter<-function(dataset){
  filter(dataset,dataset$serve.result=="A")
}
```

dffilter: Returns all double faults in a given dataset
```{r}
dffilter<-function(dataset){
  filter(dataset,dataset$serve.result=="D")
}
```

sclutchwins: Returns all short points won by BYU winners or opponent forced errors
```{r}
sclutchwins<-function(dataset){
  filter(dataset,dataset$point.length=="S" & dataset$point.winner=="P" & dataset$result %in% c("W","F"))
}
```

schokelosses: Returns all short points lost by opponent winners or BYU Forced errors 
Low Pressure Calculating function
```{r}
schokelosses<-function(dataset){
  filter(dataset,dataset$point.length=="S" & dataset$point.winner=="O" & dataset$result %in% c("W","F"))
}
```

Serving Scoring function
```{r}
servingscore<-function(dataset){
  clutch<-rbind(filter(dataset,dataset$point.winner=="P" & dataset$point.length=="S" & dataset$result %in% c("W","F") & dataset$server=="P"), filter(dataset, dataset$result=="A" & dataset$server=="P"))
  choke<-rbind(filter(dataset,dataset$point.winner=="O" & dataset$point.length=="S" & dataset$result %in% c("W","F") & dataset$server=="P"), filter(dataset, dataset$result=="D" & dataset$server=="P"))
  nullval<-dim(filter(dataset,dataset$server=="P"))[1]-dim(clutch)[1]-dim(choke)[1]
  #we can add in modifiers if we so desire here turning our score into a single value instead of 3 separate pieces
  score<-c(dim(clutch)[1],dim(choke)[1],nullval)
  return(score)
}
```

Play Scoring function
```{r}
playscore<-function(dataset){
  clutch<-filter(dataset,dataset$point.winner=="P" & dataset$result %in% c("W","F"))
  choke<-filter(dataset,dataset$point.winner=="O" & dataset$result == "U")
  nullval<-rbind(filter(dataset,dataset$point.winner=="P" & dataset$result == "U"), filter(dataset,dataset$point.winner=="O" & dataset$result %in% c("W","F")))
  #we can add in modifiers if we so desire here
  score<-c(dim(clutch)[1],dim(choke)[1],dim(nullval)[1])
  return(score)
}
```

Serving + Play Clutch Score
```{r}
clutchscore<-function(dataset){
  score<-playscore(dataset)+servingscore(dataset)
  return(score)
}
```


BYU Hold Point Calculating function
```{r}
BYUholdcolumn<-function(dataset){
  #build the BYU holding data frame including the deuce points
  byuholddf<-rbind(
    dataset[(dataset$player.points == 3 & dataset$opp.points == 3) & dataset$server== "P",],
    dataset[(dataset$player.points == 3 & dataset$opp.points == 2) & dataset$server== "P",],
    dataset[(dataset$player.points == 3 & dataset$opp.points == 1) & dataset$server== "P",],
    dataset[(dataset$player.points == 3 & dataset$opp.points == 0) & dataset$server== "P",])
  byuholdservingscore<-servingscore(byuholddf)
  byuholdplayscore<-playscore(byuholddf)
  byuholdclutchscore<-clutchscore(byuholddf)
  byuholdscores<-list(byuholdservingscore,byuholdplayscore,byuholdclutchscore)
  return(byuholdscores)
}
```

BYU being broken Point Calculating function
```{r}
BYUbreakcolumn<-function(dataset){
  #build the BYU to be broken data frame including the deuce points
  byubreakdf<-rbind(
    dataset[(dataset$player.points == 3 & dataset$opp.points == 3) & dataset$server== "P",],
    dataset[(dataset$player.points == 2 & dataset$opp.points == 3) & dataset$server== "P",],
    dataset[(dataset$player.points == 1 & dataset$opp.points == 3) & dataset$server== "P",],
    dataset[(dataset$player.points == 0 & dataset$opp.points == 3) & dataset$server== "P",])
  byubreakservingscore<-servingscore(byubreakdf)
  byubreakplayscore<-playscore(byubreakdf)
  byubreakclutchscore<-clutchscore(byubreakdf)
  byubreakscores<-list(byubreakservingscore,byubreakplayscore,byubreakclutchscore)
  return(byubreakscores)
}
```

Opp Hold Point Calculating function
```{r}
oppholdcolumn<-function(dataset){
  #build the opp holding data frame including the deuce points
  oppholddf<-rbind(
    dataset[(dataset$player.points == 3 & dataset$opp.points == 3) & dataset$server== "O",],
    dataset[(dataset$player.points == 2 & dataset$opp.points == 3) & dataset$server== "O",],
    dataset[(dataset$player.points == 1 & dataset$opp.points == 3) & dataset$server== "O",],
    dataset[(dataset$player.points == 0 & dataset$opp.points == 3) & dataset$server== "O",])
  oppholdplayscore<-playscore(oppholddf)
  oppholdclutchscore<-clutchscore(oppholddf)
  oppholdscores<-list(oppholdplayscore,oppholdclutchscore)
  return(oppholdscores)
}
```

Opp being broken Point Calculating function
```{r}
oppbreakcolumn<-function(dataset){
  #build the opp breaking data frame including the deuce points
  oppbreakdf<-rbind(
    dataset[(dataset$player.points == 3 & dataset$opp.points == 3) & dataset$server== "O",],
    dataset[(dataset$player.points == 3 & dataset$opp.points == 2) & dataset$server== "O",],
    dataset[(dataset$player.points == 3 & dataset$opp.points == 1) & dataset$server== "O",],
    dataset[(dataset$player.points == 3 & dataset$opp.points == 0) & dataset$server== "O",])
  oppbreakplayscore<-playscore(oppbreakdf)
  oppbreakclutchscore<-clutchscore(oppbreakdf)
  oppbreakscores<-list(oppbreakplayscore,oppbreakclutchscore)
  return(oppbreakscores)
}
```

Raw Combo Calculating function
```{r}
RawCombo<-function(dataset){
  #read in the four pressure column situations
  BYUhold<-BYUholdcolumn(dataset)
  BYUbreak<-BYUbreakcolumn(dataset)
  opphold<-oppholdcolumn(dataset)
  oppbreak<-oppbreakcolumn(data)
  
  #initialize and then fill in rawcombocolumn
  rawcombocolumn<-NULL

  
  rawcombocolumn[1]<-for(i in 1:3){
    serves<-unlist(BYUhold[1])[1]+unlist(BYUbreak[1])[1]
    play<-
  }
    
    unlist(BYUhold[1])[1]+unlist(BYUbreak[1])[1]
  rawcombocolumn[2]<-unlist(BYUhold[1])[1]+unlist(BYUbreak[1])[1]
  
  rawcombocolumn<-c(
    sum(BYUholdcolumn,BYUbreakcolumn, oppholdcolumn, oppbreakcolumn))
  return(rawcombocolumn)
}
```

Let's read in Ethan's data
```{r}
#read it in and separate out just the parts we need
ethantest<-read.csv("Ethan test.csv",header=T)[1:71,]
ethanservingdata<-(cbind(ethantest[,c(11:12,14:16,18:21,22:24)],ethantest[,32]))
ethanjoint<-as.tbl(ethanservingdata)
colnames(ethanjoint)<-c("player.sets","opp.sets","player.games","opp.games","server", "player.points", "opp.points", "serve.result", "serve.location", "return.location", "result", "point.winner", "point.length")
```

Now let's test the simple functions on Ethan's Data
```{r}
ethanhp<-highpressure(ethanjoint)
ethanlp<-lowpressure(ethanjoint)
ethansclutch<-sclutchwins(ethanjoint)
ethanschoke<-schokelosses(ethanjoint)
servingscore(ethanjoint) #add to 36 which is our # of times P served
playscore(ethanjoint) #total is 44, so we need to prove we discount 27. Which is exactly the number of times the result is either empty, "A" or "D"
clutchscore(ethanjoint) #works out fine
```

Now we're into the complicated stuff that actually generates what values will be scored and then put into the table
```{r}
#concern: With the Ethan data serve returns into the net weren't logged as forced or unforced errors...
ethanBYUhold<-BYUholdcolumn(ethanjoint)
ethanBYUhold
ethanBYUbreak<-BYUbreakcolumn(ethanjoint)
ethanBYUbreak
ethanopphold<-oppholdcolumn(ethanjoint)
ethanopphold
ethanoppbreak<-oppbreakcolumn(ethanjoint)
ethanoppbreak
ethanrawcombo<-RawCombo(ethanjoint)
```


Just a workspace chunk
```{r}
  rawcombocolumn<-NULL
unlist(ethanBYUhold[1])[1]
  rawcombocolumn[1]<-unlist(ethanBYUhold[1]) + unlist(ethanBYUbreak[1])
  rawcombocolumn
```

