---
title: "Serving Analyses"
author: "Othon Hamill"
date: "October 24, 2018"
output: word_document
---
```{r}
################################TO-DO LIST##############################################
#probably want to build something that throws out incomplete data, or we can clean and check data before each calculation
```


```{r}
#call our necessary libraries
library(alr3)
library(MASS)
library(dplyr)
```

###################  And the functions begin  #############################

Set Score Corrector, for those situations where the set score doesn't get set back to 0-0 after a set is won
```{r}
SetScoreCorrector<-function(Data){
  N<-dim(Data)[1]
  Errors<-rep(0,times=N)
  
  #Here's our work for a win on the players side not being counted correctly
    for (i in 1:N){
        Errors[i]<- (Data$PlayerGames[i] >= 6 & Data$OppGames[i] < 5)
    }
  
    #here we correct the game/set scores. We make the assumption our Data has the sets correct
    Data$PlayerGames<-Data$PlayerGames-Errors*(6)
  
    return(Data)
}
```


Just BYU Serving
```{r}
pservingonly<-function(rawdata){
  joint<-filter(rawdata,rawdata$Server=="P")
}
```

Deuce and ad creator
```{r}
deuceadcreator<-function(joint, AdScoring = FALSE){
  #just deuce points
  
if(AdScoring == T){
  deuce<-rbind(joint[(joint$PlayerPoints+joint$OppPoints %% 2) == 0,])
  ad<-rbind(joint[(joint$PlayerPoints+joint$OppPoints %% 2) == 1,])
}
  
else{
  deuce<-rbind(
    joint[joint$PlayerPoints+joint$OppPoints == 0,],
    joint[joint$PlayerPoints+joint$OppPoints == 2,],
    joint[joint$PlayerPoints+joint$OppPoints == 4,])

#just ad points
  ad<-rbind(
    joint[joint$PlayerPoints+joint$OppPoints == 1,],
    joint[joint$PlayerPoints+joint$OppPoints == 3,],
    joint[joint$PlayerPoints+joint$OppPoints == 5,])
}
  
dajlist<-list(deuce,ad,joint)
return(dajlist)
}
```


Court Distribution Calculator function that creates the first row of the table
```{r}
courtdistfunc<-function(deuce,ad,joint)
{
  ndfdeuce<-sum(deuce$ServeResult=="D")
  ndeuce<-dim(deuce)[1]-ndfdeuce
  dw<-sum(deuce$ServeLocation=="W")/ndeuce
  db<-sum(deuce$ServeLocation=="B")/ndeuce
  dl<-(sum(deuce$ServeLocation%in%c("L","C","T")))/ndeuce
  
  ndfad<-sum(ad$ServeResult=="D")
  nad<-dim(ad)[1]-ndfad
  aw<-sum(ad$ServeLocation=="W")/nad
  ab<-sum(ad$ServeLocation=="B")/nad
  al<-(sum(ad$ServeLocation%in%c("L","C","T")))/nad
  
  ndfjoint<-sum(joint$ServeResult=="D")
  njoint<-dim(joint)[1]-ndfjoint
  jw<-sum(joint$ServeLocation=="W")/njoint
  jb<-sum(joint$ServeLocation=="B")/njoint
  jl<-(sum(joint$ServeLocation%in%c("L","C","T")))/njoint
  
  
  courtdistlist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(courtdistlist)
}
```

AcePercFunc gives us the percentages of shots to a given area that result in aces
```{r}
AcePercFunc<-function(deuce,ad,joint)
{

  adeuce<-filter(deuce,deuce$ServeLocation%in%c("W", "B", "C", "L", "T"))
  ndeuce<-dim(adeuce)[1]
  if(ndeuce==0){
    dw<-0
    db<-0
    dl<-0
  }
  else{
    dw<-sum(adeuce$ServeLocation=="W")/ndeuce
    db<-sum(adeuce$ServeLocation=="B")/ndeuce
    dl<-sum(adeuce$ServeLocation%in%c("L","C","T"))/ndeuce
  }
 
  
  aad<-filter(ad,ad$ServeLocation%in%c("W", "B", "C", "L", "T"))
  nad<-dim(aad)[1]
  if(nad==0){
    aw<-0
    ab<-0
    al<-0
  }
  else{
    aw<-sum(aad$ServeLocation=="W")/nad
    ab<-sum(aad$ServeLocation=="B")/nad
    al<-sum(aad$ServeLocation%in%c("L","C","T"))/nad
  }

  
  ajoint<-filter(joint,joint$ServeLocation%in%c("W", "B", "C", "L", "T"))
  njoint<-dim(ajoint)[1]
  if(njoint==0){
    jw<-0
    jb<-0
    jl<-0
  }
  else{
  jw<-sum(ajoint$ServeLocation=="W")/njoint
  jb<-sum(ajoint$ServeLocation=="B")/njoint
  jl<-sum(ajoint$ServeLocation%in%c("L","C","T"))/njoint
  }
  
  aceperclist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(aceperclist)
}
```


Ace Distribution Function
```{r}
AceDistFunc<-function(deuce,ad,joint)
{
  ajoint<-filter(joint,joint$Result=="A" & joint$ServeLocation%in%c("W", "B", "C", "L", "T"))
  njoint<-dim(ajoint)[1]
  
  adeuce<-filter(deuce,deuce$Result=="A")
  ndeuce<-dim(adeuce)[1]
  if(ndeuce==0){
    dw<-db<-dl<-0
  }
  else{
    dw<-sum(adeuce$ServeLocation=="W")/njoint
    db<-sum(adeuce$ServeLocation=="B")/njoint
    dl<-sum(adeuce$ServeLocation%in%c("L","C","T"))/njoint
  }
 
  
  aad<-filter(ad,ad$Result=="A")
  nad<-dim(aad)[1]
  if(nad==0){
    aw<-ab<-al<-0
  }
  else{
    aw<-sum(aad$ServeLocation=="W")/njoint
    ab<-sum(aad$ServeLocation=="B")/njoint
    al<-sum(aad$ServeLocation%in%c("L","C","T"))/njoint
  }
  

  if(njoint==0){
    jw<-jb<-jl<-0
  }
  else{
    jw<-sum(ajoint$ServeLocation=="W")/njoint
    jb<-sum(ajoint$ServeLocation=="B")/njoint
    jl<-sum(ajoint$ServeLocation%in%c("L","C","T"))/njoint
  }
  
  
  aceproblist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(aceproblist)
}
```


Short Game Win Percentage Calculator
```{r}
shortgamewinperc<-function(deuce,ad,joint)
{
  
  sdeuce<-filter(deuce,deuce$PointLength=="S")
  swindeuce<-filter(sdeuce,sdeuce$PointWinner=="P")
  swindeuce<-as.tbl(swindeuce)
  dw<-sum(swindeuce$ServeLocation=="W")/sum(sdeuce$ServeLocation=="W")
  db<-sum(swindeuce$ServeLocation=="B")/sum(sdeuce$ServeLocation=="B")
  dl<-sum(swindeuce$ServeLocation%in%c("L","C","T"))/sum(sdeuce$ServeLocation%in%c("L","C","T"))
  
  sad<-filter(ad,ad$PointLength=="S")
  swinad<-filter(sad,sad$PointWinner=="P")
  swinad<-as.tbl(swinad)
  aw<-sum(swinad$ServeLocation=="W")/sum(sad$ServeLocation=="W")
  ab<-sum(swinad$ServeLocation=="B")/sum(sad$ServeLocation=="B")
  al<-sum(swinad$ServeLocation%in%c("L","C","T"))/sum(sad$ServeLocation%in%c("L","C","T"))
  
  sjoint<-filter(joint,joint$PointLength=="S")
  swinjoint<-filter(sjoint,sjoint$PointWinner=="P")
  swinjoint<-as.tbl(swinjoint)
  jw<-sum(swinjoint$ServeLocation=="W")/sum(sjoint$ServeLocation=="W")
  jb<-sum(swinjoint$ServeLocation=="B")/sum(sjoint$ServeLocation=="B")
  jl<-sum(swinjoint$ServeLocation%in%c("L","C","T"))/sum(sjoint$ServeLocation%in%c("L","C","T"))
  
  
  shortgamewinperclist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(shortgamewinperclist)
}
```

First Serve Placement Calculator
```{r}
firstcourtdist<-function(deuce,ad,joint)
{
  fdeuce<-filter(deuce,deuce$ServeResult=="F")
  nfdeuce<-dim(fdeuce)[1]
  dw<-sum(fdeuce$ServeLocation=="W")/nfdeuce
  db<-sum(fdeuce$ServeLocation=="B")/nfdeuce
  dl<-(sum(fdeuce$ServeLocation%in%c("L","C","T")))/nfdeuce
  
  fad<-filter(ad,ad$ServeResult=="F")
  nfad<-dim(fad)[1]
  aw<-sum(fad$ServeLocation=="W")/nfad
  ab<-sum(fad$ServeLocation=="B")/nfad
  al<-(sum(fad$ServeLocation%in%c("L","C","T")))/nfad
  
  fjoint<-filter(joint,joint$ServeResult=="F")
  nfjoint<-dim(fjoint)[1]
  jw<-sum(fjoint$ServeLocation=="W")/nfjoint
  jb<-sum(fjoint$ServeLocation=="B")/nfjoint
  jl<-(sum(fjoint$ServeLocation%in%c("L","C","T")))/nfjoint
  
  
  firstcourtdistlist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(firstcourtdistlist)
}
```

Second Serve Placement Calculator
```{r}
secondcourtdist<-function(deuce,ad,joint)
{
  sdeuce<-filter(deuce,deuce$ServeResult=="S")
  nsdeuce<-dim(sdeuce)[1]
  dw<-sum(sdeuce$ServeLocation=="W")/nsdeuce
  db<-sum(sdeuce$ServeLocation=="B")/nsdeuce
  dl<-(sum(sdeuce$ServeLocation%in%c("L","C","T")))/nsdeuce
  
  sad<-filter(ad,ad$ServeResult=="S")
  nsad<-dim(sad)[1]
  aw<-sum(sad$ServeLocation=="W")/nsad
  ab<-sum(sad$ServeLocation=="B")/nsad
  al<-(sum(sad$ServeLocation%in%c("L","C","T")))/nsad
  
  sjoint<-filter(joint,joint$ServeResult=="S")
  nsjoint<-dim(sjoint)[1]
  jw<-sum(sjoint$ServeLocation=="W")/nsjoint
  jb<-sum(sjoint$ServeLocation=="B")/nsjoint
  jl<-(sum(sjoint$ServeLocation%in%c("L","C","T")))/nsjoint
  
  
  secondcourtdistlist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(secondcourtdistlist)
}
```

Under Pressure Calculator. Doesnt work if there's dividing by 0 issues. NPDeuce is usually the culprit. 
```{r}
UnderPressureDistribution<-function(deuce, ad, joint){
  PDeuce<-filter(deuce,deuce$ServeResult=="S" &
                        deuce$PlayerPoints==1 & deuce$OppPoints==3)
  NPDeuce<-dim(PDeuce)[1]
  DW<-sum(PDeuce$ServeLocation=="W")/NPDeuce
  DB<-sum(PDeuce$ServeLocation=="B")/NPDeuce
  DL<-(sum(PDeuce$ServeLocation%in%c("L","C","T")))/NPDeuce
  
  PAd<-filter(ad,ad$ServeResult=="S" & (
                        ad$PlayerPoints==2 & ad$OppPoints==3 |
                        ad$PlayerPoints==0 & ad$OppPoints==3 |
                        ad$PlayerPoints==3 & ad$OppPoints==2 ))
  NPAd<-dim(PAd)[1]
  AW<-sum(PAd$ServeLocation=="W")/NPAd
  AB<-sum(PAd$ServeLocation=="B")/NPAd
  AL<-(sum(PAd$ServeLocation%in%c("L","C","T")))/NPAd
  
  PJoint<-filter(joint,joint$ServeResult=="S" & (
                        joint$PlayerPoints==3 & joint$OppPoints==3 |
                        joint$PlayerPoints==2 & joint$OppPoints==3 |
                        joint$PlayerPoints==1 & joint$OppPoints==3 |
                        joint$PlayerPoints==0 & joint$OppPoints==3 |
                        joint$PlayerPoints==3 & joint$OppPoints==2 ))
  NPJoint<-dim(PJoint)[1]
  JW<-sum(PJoint$ServeLocation=="W")/NPJoint
  JB<-sum(PJoint$ServeLocation=="B")/NPJoint
  JL<-(sum(PJoint$ServeLocation%in%c("L","C","T")))/NPJoint
  
  
  pressuredistlist<-c(DW, DB, DL, AL, AB, AW, JL, JB, JW)
  return(pressuredistlist)
}
```


Double Fault Percentage Calculator
```{r}
dfperc<-function(deuce,ad,joint)
{
  nddeuce<-sum(deuce$ServeResult=="D")
  ndeuce<-dim(deuce)[1]
  dfd<-nddeuce/ndeuce
  
  ndad<-sum(ad$ServeResult=="D")
  nad<-dim(ad)[1]
  dfa<-ndad/nad
  
  ndjoint<-sum(joint$ServeResult=="D")
  njoint<-dim(joint)[1]
  dfj<-ndjoint/njoint
  
  
  dflist<-c(dfd,dfa,dfj)
  return(dflist)
}
```

Situational Weights adds an additional column which gives a weight score for each point
40-00 gets a .3 multiplier, 40-15 a .7, 40-30 a 1.0, Deuce a 2x
4-4 and 5-5 get a x1.5 multiplier
Set Points get x2
Second Set Match Points get a x3 Multiplier
Third Set Match Points get a x3 Multiplier

5-4, 4-5, 6-5 and 5-6 gets a +1


```{r}
SituationalWeights<-function(Data){
  N<-dim(Data)[1]
  Multiplier<-rep(0,times=N)
  
  #Game Points by score weight
  for (i in 1:N){
    if(Data$PlayerPoints[i] == 0 & Data$OppPoints[i] == 3){Multiplier[i]<-.3}
    if(Data$OppPoints[i] == 0 & Data$PlayerPoints[i] == 3){Multiplier[i]<-.3}
    if(Data$PlayerPoints[i] == 1 & Data$OppPoints[i] == 3){Multiplier[i]<-.7}
    if(Data$OppPoints[i] == 1 & Data$PlayerPoints[i] == 3){Multiplier[i]<-.7}
    if(Data$PlayerPoints[i] == 2 & Data$OppPoints[i] == 3){Multiplier[i]<-1}
    if(Data$OppPoints[i] == 2 & Data$PlayerPoints[i] == 3){Multiplier[i]<-1}
    if(Data$PlayerPoints[i] == 3 & Data$OppPoints[i] == 3){Multiplier[i]<-2}
  }
  
  #Game points under duress at 4-4 or 5-5 set score. High Pressure already keeps only game points
  for (i in 1:N){
    if(Data$PlayerGames[i] == 4 & Data$OppGames[i] == 4){Multiplier[i]<-Multiplier[i]*1.5}
    if(Data$OppGames[i] == 5 & Data$PlayerGames[i] == 5){Multiplier[i]<-Multiplier[i]*1.5}
  }

  #Set Points, 1st set about to be won by either or second about to be won by the loser of the first set
  for (i in 1:N){
    #opp about to win the set
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 6) {Multiplier[i]<-Multiplier[i]*2+1}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 4 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2+1}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 3 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 2 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 1 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 0 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2}
    #player about to win the set
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 6 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2+1}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 4) {Multiplier[i]<-Multiplier[i]*2+1}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 3) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 2) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 1) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 0) {Multiplier[i]<-Multiplier[i]*2}
  }
  
  #Match Points in the second set
  for(i in 1:N){
    #player about to win
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 6 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 4) {Multiplier[i]<-Multiplier[i]*3+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 3) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 2) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 1) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 0) {Multiplier[i]<-Multiplier[i]*3}
    #opponent about to win
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 6) {Multiplier[i]<-Multiplier[i]*3+1}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 4 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3+1}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 3 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 2 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 1 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 0 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3}
  }
  
  #Match Points in the Third set
  for(i in 1:N){
    #player about to win
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 6 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 4) {Multiplier[i]<-Multiplier[i]*5+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 3) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 2) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 1) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 0) {Multiplier[i]<-Multiplier[i]*5}
    #opponent about to win
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 6) {Multiplier[i]<-Multiplier[i]*5+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 4 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 3 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 2 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 1 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 0 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5}
  }
  
  return(Multiplier)
}

```

Serving Scoring function
```{r}
servingscore<-function(DataSet, W=c(1,-1,0)){
  clutch<-rbind(filter(DataSet,DataSet$PointWinner=="P" & DataSet$PointLength=="S" & DataSet$Result %in% c("W","F") & DataSet$Server=="P"), filter(DataSet, DataSet$Result=="A" & DataSet$Server=="P"))
  choke<-rbind(filter(DataSet,DataSet$PointWinner=="O" & DataSet$PointLength=="S" & DataSet$Result %in% c("W","F") & DataSet$Server=="P"), filter(DataSet, DataSet$Result=="D" & DataSet$Server=="P"))
  null<-rbind(filter(DataSet, DataSet$ServeResult %in% c("F","S") & DataSet$PointLength %in% c("M","L") & DataSet$Server=="P"))
  #we add an if here to catch when we run the LPcolum through serving, sicne the situational weights of low pressure situations are 0. Here, if we find all the values are 0 we just use the dimensions in the calculation
  if(sum(clutch$SituationalWeight)+sum(choke$SituationalWeight)+sum(null$SituationalWeight) == 0){
    score<-dim(clutch)[1]*W[1]+dim(choke)[1]*W[2]+dim(null)[1]*W[3]
  }
  else{
    score<-c(sum(clutch$SituationalWeight)*W[1]+sum(choke$SituationalWeight)*W[2]+sum(null$SituationalWeight)*W[3])
  }
  
  return(score)
}
```

Serving Score Applied to W/B/L D/A/J
```{r}
AppliedScoring<-function(deuce, ad, joint, W=c(1,-1,0) ){
  DW<-servingscore(filter(deuce, deuce$ServeLocation=="W"))
  DB<-servingscore(filter(deuce, deuce$ServeLocation=="B"))
  DL<-servingscore(filter(deuce, deuce$ServeLocation=="L"))
  AW<-servingscore(filter(ad, ad$ServeLocation=="W"))
  AB<-servingscore(filter(ad, ad$ServeLocation=="B"))
  AL<-servingscore(filter(ad, ad$ServeLocation%in%c("L","C","T")))
  JW<-servingscore(filter(joint, joint$ServeLocation=="W"))
  JB<-servingscore(filter(joint, joint$ServeLocation=="B"))
  JL<-servingscore(filter(joint, joint$ServeLocation%in%c("L","C","T")))
  appliedscores<-c(DW, DB, DL, AL, AB, AW, JL, JB, JW)
  return(appliedscores)
}
```

FormatData: Does all the formating we need before throwing it in FullMatrix
NewExcel doesn't sort by Player ID
OldSQL includes player ID but doesn't sort by it, sino just puts it all together and leaves a new variable called PlayerID
```{r}
FormatData<-function(RawData,DataType="OldSQL"){
  if(DataType=="NewExcel"){
    JointData<-(cbind(RawData[,c(1,11:23,30)],rep(0,length=dim(RawData)[1])))
  }
  if(DataType=="OldSQL"){
    JointData<-(cbind(RawData[,c(3:15,18)],rep(0,length=dim(RawData)[1])))
  }
  colnames(JointData)<-c("PlayerID","PlayerSets","OppSets","PlayerGames","OppGames","Server", "PlayerPoints", "OppPoints", "ServeResult", "ServeLocation", "ReturnLocation", "Result", "PointWinner", "PointLength","SituationalWeight")
  JointData<-SetScoreCorrector(JointData)
  JointData<-as.tbl(JointData)
  JointData$SituationalWeight<-SituationalWeights(JointData)
  return(JointData)
}

```

Prepare the full matrix before we throw it into a table
NOTE: This doesn't run with player ID included
```{r}
FullMatrix<-function(DataSet,DataType="OldSQL"){
  #Format the Matrix
  MATRIX<-matrix(data=0,nrow=9,ncol = 9)
  rownames(MATRIX)<-c("Distribution", "First Serve Distribution", "Second Serve Distribution", "Under Pressure %", "Ace Distribution", "Ace Probability", "Short Game Win %", "Double Fault %", "Weighted Clutch Serving Score")

  servingdata<-pservingonly(DataSet)
  colnames(servingdata)<-c("PlayerSets","OppSets","PlayerGames","OppGames","Server", "PlayerPoints", "OppPoints", "ServeResult", "ServeLocation", "ReturnLocation", "Result", "PointWinner", "PointLength")
    
  servingdata<-cbind(servingdata,SituationalWeights(servingdata))
  colnames(servingdata)<-c("PlayerSets","OppSets","PlayerGames","OppGames","Server", "PlayerPoints", "OppPoints", "ServeResult", "ServeLocation", "ReturnLocation", "Result", "PointWinner", "PointLength", "SituationalWeights")
  daj<-deuceadcreator(servingdata)
    deuce<-as.data.frame(daj[1])
    ad<-as.data.frame(daj[2])
    joint<-as.data.frame(daj[3])
    
  MATRIX[1,]<-courtdistfunc(deuce,ad,joint)
  MATRIX[2,]<-firstcourtdist(deuce,ad,joint)
  MATRIX[3,]<-secondcourtdist(deuce,ad,joint)
  MATRIX[4,]<-UnderPressureDistribution(deuce,ad,joint)
  MATRIX[5,]<-AceDistFunc(deuce,ad,joint)
  MATRIX[6,]<-AcePercFunc(deuce,ad,joint)
  MATRIX[7,]<-shortgamewinperc(deuce,ad,joint)
  MATRIX[8,]<-dfperc(deuce,ad,joint)
  MATRIX[9,]<-AppliedScoring(deuce,ad,joint)

  return(MATRIX)
}
```

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Here's our workspace after all the functions~~~~~~~~~~~~~~~~~~~~~~~~

```{r}
#read it in and separate out just the parts we need
ethantest<-read.csv("Ethan test.csv",header=T)[1:71,]
ethanservingdata<-(cbind(ethantest[,c(11:12,14:16,18:21,22:24)],ethantest[,32]))
ethanservingdata<-as.tbl(ethanservingdata)
ethanservingdata<-filter(ethanservingdata,ethanservingdata$server=="P")
colnames(ethanservingdata)<-c("PlayerSets","OppSets","PlayerGames","OppGames","Server", "PlayerPoints", "OppPoints", "ServeResult", "ServeLocation", "ReturnLocation", "Result", "PointWinner", "PointLength")
```

```{r}
#now let's try to call all of these functions
ethanservingdata<-cbind(pservingonly(ethanservingdata),SituationalWeights(ethanservingdata))
colnames(ethanservingdata)<-c("PlayerSets","OppSets","PlayerGames","OppGames","Server", "PlayerPoints", "OppPoints", "ServeResult", "ServeLocation", "ReturnLocation", "Result", "PointWinner", "PointLength", "SituationalWeights")
ethandaj<-deuceadcreator(ethanservingdata)
  ethandeuce<-as.data.frame(ethandaj[1])
  ethanad<-as.data.frame(ethandaj[2])
  ethanjoint<-as.data.frame(ethandaj[3])
courtdistfunc(ethandeuce,ethanad,ethanjoint)
AcePercFunc(ethandeuce,ethanad,ethanjoint)
AceDistFunc(ethandeuce,ethanad,ethanjoint)
shortgamewinperc(ethandeuce,ethanad,ethanjoint)
firstcourtdist(ethandeuce,ethanad,ethanjoint)
secondcourtdist(ethandeuce,ethanad,ethanjoint)
dfperc(ethandeuce,ethanad,ethanjoint)
UnderPressureDistribution(ethandeuce,ethanad,ethanjoint)
AppliedScoring(ethandeuce,ethanad,ethanjoint)

FullMatrix(ethanservingdata)
```


```{r}
WData<-read.csv("WTennisStats.csv")
#this cuts out our former issue by removing the PlayerID column. Remember that FullMatrix only runs with that PlayerID precluded
TestFormat<-FormatData(WData)[2:15]

#Not sure why the short game win % is wonky. 
FullMatrix(TestFormat)

```



