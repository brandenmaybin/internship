---
title: "Serving Analyses"
author: "Othon Hamill"
date: "October 24, 2018"
output: word_document
---
```{r}
################################TO-DO LIST##############################################
#probably want to build something that throws out incomplete data, or we can clean and check data before each calculation
```


```{r}
#call our necessary libraries
library(alr3)
library(MASS)
library(dplyr)
```

###################  And the functions begin  #############################

Just BYU Serving
```{r}
pservingonly<-function(rawdata){
  joint<-filter(rawdata,rawdata$server=="P")
}
```

Deuce and ad creator
```{r}
deuceadcreator<-function(joint, AdScoring = FALSE){
  #just deuce points
  
if(AdScoring == T){
  deuce<-rbind(joint[(joint$player.points+joint$opp.points %% 2) == 0,])
  ad<-rbind(joint[(joint$player.points+joint$opp.points %% 2) == 1,])
}
  
else{
  deuce<-rbind(
    joint[joint$player.points+joint$opp.points == 0,],
    joint[joint$player.points+joint$opp.points == 2,],
    joint[joint$player.points+joint$opp.points == 4,])

#just ad points
  ad<-rbind(
    joint[joint$player.points+joint$opp.points == 1,],
    joint[joint$player.points+joint$opp.points == 3,],
    joint[joint$player.points+joint$opp.points == 5,])
}
  
dajlist<-list(deuce,ad,joint)
return(dajlist)
}
```


Court Distribution Calculator function that creates the first row of the table
```{r}
courtdistfunc<-function(deuce,ad,joint)
{
  ndfdeuce<-sum(deuce$serve.result=="D")
  ndeuce<-dim(deuce)[1]-ndfdeuce
  dw<-sum(deuce$serve.location=="W")/ndeuce
  db<-sum(deuce$serve.location=="B")/ndeuce
  dl<-(sum(deuce$serve.location=="T")+sum(deuce$serve.location=="L"))/ndeuce
  
  ndfad<-sum(ad$serve.result=="D")
  nad<-dim(ad)[1]-ndfad
  aw<-sum(ad$serve.location=="W")/nad
  ab<-sum(ad$serve.location=="B")/nad
  al<-(sum(ad$serve.location=="T")+sum(ad$serve.location=="L"))/nad
  
  ndfjoint<-sum(joint$serve.result=="D")
  njoint<-dim(joint)[1]-ndfjoint
  jw<-sum(joint$serve.location=="W")/njoint
  jb<-sum(joint$serve.location=="B")/njoint
  jl<-(sum(joint$serve.location=="T")+sum(joint$serve.location=="L"))/njoint
  
  
  courtdistlist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(courtdistlist)
}
```

Ace Distribution Calculator that creates the second row of the table
```{r}
acedistfunc<-function(deuce,ad,joint)
{
  adeuce<-filter(deuce,deuce$serve.result=="A")
  ndeuce<-dim(adeuce)[1]
  if(ndeuce==0){
    dw<-0
    db<-0
    dl<-0
  }
  else{
    dw<-sum(adeuce$serve.location=="W")/ndeuce
    db<-sum(adeuce$serve.location=="B")/ndeuce
    dl<-sum(adeuce$serve.location=="T")/ndeuce
  }
 
  
  aad<-filter(ad,ad$serve.result=="A")
  nad<-dim(aad)[1]
  if(nad==0){
    aw<-0
    ab<-0
    al<-0
  }
  else{
    aw<-sum(aad$serve.location=="W")/nad
    ab<-sum(aad$serve.location=="B")/nad
    al<-sum(aad$serve.location=="T")/nad
  }

  
  ajoint<-filter(joint,joint$serve.result=="A")
  njoint<-dim(ajoint)[1]
  if(njoint==0){
    jw<-0
    jb<-0
    jl<-0
  }
  else{
  jw<-sum(ajoint$serve.location=="W")/njoint
  jb<-sum(ajoint$serve.location=="B")/njoint
  jl<-sum(ajoint$serve.location=="T")/njoint
  }
  
  acedistlist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(acedistlist)
}
```


Ace Probability Function
```{r}
aceprobfunc<-function(deuce,ad,joint)
{
  ajoint<-filter(joint,joint$serve.result=="A")
  njoint<-dim(ajoint)[1]
  
  adeuce<-filter(deuce,deuce$serve.result=="A")
  ndeuce<-dim(adeuce)[1]
  if(ndeuce==0){
    dw<-0
    db<-0
    dl<-0
  }
  else{
    dw<-sum(adeuce$serve.location=="W")/njoint
    db<-sum(adeuce$serve.location=="B")/njoint
    dl<-sum(adeuce$serve.location=="T")/njoint
  }
 
  
  aad<-filter(ad,ad$serve.result=="A")
  nad<-dim(aad)[1]
  if(nad==0){
    aw<-0
    ab<-0
    al<-0
  }
  else{
    aw<-sum(aad$serve.location=="W")/njoint
    ab<-sum(aad$serve.location=="B")/njoint
    al<-sum(aad$serve.location=="T")/njoint
  }
  

  if(njoint==0){
    jw<-0
    jb<-0
    jl<-0
  }
  else{
    dw<-sum(ajoint$serve.location=="W")/njoint
    db<-sum(ajoint$serve.location=="B")/njoint
    dl<-sum(ajoint$serve.location=="T")/njoint
  }
  
  
  aceproblist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(aceproblist)
}
```


Short Game Win Percentage Calculator
```{r}
shortgamewinperc<-function(deuce,ad,joint)
{
  
  sdeuce<-filter(deuce,deuce$point.length=="S")
  swindeuce<-filter(sdeuce,sdeuce$point.winner=="P")
  swindeuce<-as.tbl(swindeuce)
  dw<-sum(swindeuce$serve.location=="W")/sum(sdeuce$serve.location=="W")
  db<-sum(swindeuce$serve.location=="B")/sum(sdeuce$serve.location=="B")
  dl<-sum(swindeuce$serve.location=="T")/sum(sdeuce$serve.location=="T")
  
  sad<-filter(ad,ad$point.length=="S")
  swinad<-filter(sad,sad$point.winner=="P")
  swinad<-as.tbl(swinad)
  aw<-sum(swinad$serve.location=="W")/sum(sad$serve.location=="W")
  ab<-sum(swinad$serve.location=="B")/sum(sad$serve.location=="B")
  al<-sum(swinad$serve.location=="T")/sum(sad$serve.location=="T")
  
  sjoint<-filter(joint,joint$point.length=="S")
  swinjoint<-filter(sjoint,sjoint$point.winner=="P")
  swinjoint<-as.tbl(swinjoint)
  jw<-sum(swinjoint$serve.location=="W")/sum(sjoint$serve.location=="W")
  jb<-sum(swinjoint$serve.location=="B")/sum(sjoint$serve.location=="B")
  jl<-sum(swinjoint$serve.location=="T")/sum(sjoint$serve.location=="T")
  
  
  shortgamewinperclist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(shortgamewinperclist)
}
```

First Serve Placement Calculator
```{r}
firstcourtdist<-function(deuce,ad,joint)
{
  fdeuce<-filter(deuce,deuce$serve.result=="F")
  nfdeuce<-dim(fdeuce)[1]
  dw<-sum(fdeuce$serve.location=="W")/nfdeuce
  db<-sum(fdeuce$serve.location=="B")/nfdeuce
  dl<-(sum(fdeuce$serve.location=="T")+sum(fdeuce$serve.location=="L"))/nfdeuce
  
  fad<-filter(ad,ad$serve.result=="F")
  nfad<-dim(fad)[1]
  aw<-sum(fad$serve.location=="W")/nfad
  ab<-sum(fad$serve.location=="B")/nfad
  al<-(sum(fad$serve.location=="T")+sum(fad$serve.location=="L"))/nfad
  
  fjoint<-filter(joint,joint$serve.result=="F")
  nfjoint<-dim(fjoint)[1]
  jw<-sum(fjoint$serve.location=="W")/nfjoint
  jb<-sum(fjoint$serve.location=="B")/nfjoint
  jl<-(sum(fjoint$serve.location=="T")+sum(fjoint$serve.location=="L"))/nfjoint
  
  
  firstcourtdistlist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(firstcourtdistlist)
}
```

Second Serve Placement Calculator
```{r}
secondcourtdist<-function(deuce,ad,joint)
{
  sdeuce<-filter(deuce,deuce$serve.result=="S")
  nsdeuce<-dim(sdeuce)[1]
  dw<-sum(sdeuce$serve.location=="W")/nsdeuce
  db<-sum(sdeuce$serve.location=="B")/nsdeuce
  dl<-(sum(sdeuce$serve.location=="T")+sum(sdeuce$serve.location=="L"))/nsdeuce
  
  sad<-filter(ad,ad$serve.result=="S")
  nsad<-dim(sad)[1]
  aw<-sum(sad$serve.location=="W")/nsad
  ab<-sum(sad$serve.location=="B")/nsad
  al<-(sum(sad$serve.location=="T")+sum(sad$serve.location=="L"))/nsad
  
  sjoint<-filter(joint,joint$serve.result=="S")
  nsjoint<-dim(sjoint)[1]
  jw<-sum(sjoint$serve.location=="W")/nsjoint
  jb<-sum(sjoint$serve.location=="B")/nsjoint
  jl<-(sum(sjoint$serve.location=="T")+sum(sjoint$serve.location=="L"))/nsjoint
  
  
  secondcourtdistlist<-c(dw,db,dl,al,ab,aw,jl,jb,jw)
  return(secondcourtdistlist)
}
```

Under Pressure Calculator. Doesnt work if there's dividing by 0 issues. NPDeuce is usually the culprit. 
```{r}
UnderPressureDistribution<-function(deuce, ad, joint){
  PDeuce<-filter(deuce,deuce$serve.result=="S" &
                        deuce$player.points==1 & deuce$opp.points==3)
  NPDeuce<-dim(PDeuce)[1]
  DW<-sum(PDeuce$serve.location=="W")/NPDeuce
  DB<-sum(PDeuce$serve.location=="B")/NPDeuce
  DL<-(sum(PDeuce$serve.location=="T")+sum(PDeuce$serve.location=="L"))/NPDeuce
  
  PAd<-filter(ad,ad$serve.result=="S" & (
                        ad$player.points==2 & ad$opp.points==3 |
                        ad$player.points==0 & ad$opp.points==3 |
                        ad$player.points==3 & ad$opp.points==2 ))
  NPAd<-dim(PAd)[1]
  AW<-sum(PAd$serve.location=="W")/NPAd
  AB<-sum(PAd$serve.location=="B")/NPAd
  AL<-(sum(PAd$serve.location=="T")+sum(PAd$serve.location=="L"))/NPAd
  
  PJoint<-filter(joint,joint$serve.result=="S" & (
                        joint$player.points==3 & joint$opp.points==3 |
                        joint$player.points==2 & joint$opp.points==3 |
                        joint$player.points==1 & joint$opp.points==3 |
                        joint$player.points==0 & joint$opp.points==3 |
                        joint$player.points==3 & joint$opp.points==2 ))
  NPJoint<-dim(PJoint)[1]
  JW<-sum(PJoint$serve.location=="W")/NPJoint
  JB<-sum(PJoint$serve.location=="B")/NPJoint
  JL<-(sum(PJoint$serve.location=="T")+sum(PJoint$serve.location=="L"))/NPJoint
  
  
  pressuredistlist<-c(DW, DB, DL, AL, AB, AW, JL, JB, JW)
  return(pressuredistlist)
}
```


Double Fault Percentage Calculator
```{r}
dfperc<-function(deuce,ad,joint)
{
  nddeuce<-sum(deuce$serve.result=="D")
  ndeuce<-dim(deuce)[1]
  dfd<-nddeuce/ndeuce
  
  ndad<-sum(ad$serve.result=="D")
  nad<-dim(ad)[1]
  dfa<-ndad/nad
  
  ndjoint<-sum(joint$serve.result=="D")
  njoint<-dim(joint)[1]
  dfj<-ndjoint/njoint
  
  
  dflist<-c(dfd,dfa,dfj)
  return(dflist)
}
```

Situational Weights adds an additional column which gives a weight score for each point
40-00 gets a .3 multiplier, 40-15 a .7, 40-30 a 1.0, Deuce a 2x
4-4 and 5-5 get a x1.5 multiplier
Set Points get x2
Second Set Match Points get a x3 Multiplier
Third Set Match Points get a x3 Multiplier

5-4, 4-5, 6-5 and 5-6 gets a +1


```{r}
SituationalWeights<-function(Data){
  N<-dim(Data)[1]
  Multiplier<-rep(0,times=N)
  
  #Game Points by score weight
  for (i in 1:N){
    if(Data$PlayerPoints[i] == 0 & Data$OppPoints[i] == 3){Multiplier[i]<-.3}
    if(Data$OppPoints[i] == 0 & Data$PlayerPoints[i] == 3){Multiplier[i]<-.3}
    if(Data$PlayerPoints[i] == 1 & Data$OppPoints[i] == 3){Multiplier[i]<-.7}
    if(Data$OppPoints[i] == 1 & Data$PlayerPoints[i] == 3){Multiplier[i]<-.7}
    if(Data$PlayerPoints[i] == 2 & Data$OppPoints[i] == 3){Multiplier[i]<-1}
    if(Data$OppPoints[i] == 2 & Data$PlayerPoints[i] == 3){Multiplier[i]<-1}
    if(Data$PlayerPoints[i] == 3 & Data$OppPoints[i] == 3){Multiplier[i]<-2}
  }
  
  #Game points under duress at 4-4 or 5-5 set score. High Pressure already keeps only game points
  for (i in 1:N){
    if(Data$PlayerGames[i] == 4 & Data$OppGames[i] == 4){Multiplier[i]<-Multiplier[i]*1.5}
    if(Data$OppGames[i] == 5 & Data$PlayerGames[i] == 5){Multiplier[i]<-Multiplier[i]*1.5}
  }

  #Set Points, 1st set about to be won by either or second about to be won by the loser of the first set
  for (i in 1:N){
    #opp about to win the set
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 6) {Multiplier[i]<-Multiplier[i]*2+1}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 4 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2+1}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 3 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 2 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 1 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0)) & Data$PlayerGames[i] == 0 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2}
    #player about to win the set
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 6 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*2+1}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 4) {Multiplier[i]<-Multiplier[i]*2+1}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 3) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 2) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 1) {Multiplier[i]<-Multiplier[i]*2}
    if(((Data$PlayerSets[i] == 0 & Data$OppSets[i] == 0) | (Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1)) & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 0) {Multiplier[i]<-Multiplier[i]*2}
  }
  
  #Match Points in the second set
  for(i in 1:N){
    #player about to win
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 6 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 4) {Multiplier[i]<-Multiplier[i]*3+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 3) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 2) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 1) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 0 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 0) {Multiplier[i]<-Multiplier[i]*3}
    #opponent about to win
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 6) {Multiplier[i]<-Multiplier[i]*3+1}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 4 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3+1}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 3 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 2 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 1 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3}
    if(Data$PlayerSets[i] == 0 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 0 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*3}
  }
  
  #Match Points in the Third set
  for(i in 1:N){
    #player about to win
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 6 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 4) {Multiplier[i]<-Multiplier[i]*5+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 3) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 2) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 1) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 0) {Multiplier[i]<-Multiplier[i]*5}
    #opponent about to win
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 5 & Data$OppGames[i] == 6) {Multiplier[i]<-Multiplier[i]*5+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 4 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5+1}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 3 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 2 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 1 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5}
    if(Data$PlayerSets[i] == 1 & Data$OppSets[i] == 1 & Data$PlayerGames[i] == 0 & Data$OppGames[i] == 5) {Multiplier[i]<-Multiplier[i]*5}
  }
  
  return(Multiplier)
}

```

Serving Scoring function
```{r}
servingscore<-function(Dataset, W=c(1,-1,0)){
  clutch<-rbind(filter(Dataset,Dataset$PointWinner=="P" & Dataset$PointLength=="S" & Dataset$Result %in% c("W","F") & Dataset$Server=="P"), filter(Dataset, Dataset$Result=="A" & Dataset$Server=="P"))
  choke<-rbind(filter(Dataset,Dataset$PointWinner=="O" & Dataset$PointLength=="S" & Dataset$Result %in% c("W","F") & Dataset$Server=="P"), filter(Dataset, Dataset$Result=="D" & Dataset$Server=="P"))
  null<-rbind(filter(Dataset, Dataset$ServeResult %in% c("F","S") & Dataset$PointLength %in% c("M","L") & Dataset$Server=="P"))
  #we add an if here to catch when we run the LPcolum through serving, sicne the situational weights of low pressure situations are 0. Here, if we find all the values are 0 we just use the dimensions in the calculation
  if(sum(clutch$SituationalWeight)+sum(choke$SituationalWeight)+sum(null$SituationalWeight) == 0){
    score<-dim(clutch)[1]*W[1]+dim(choke)[1]*W[2]+dim(null)[1]*W[3]
  }
  else{
    score<-c(sum(clutch$SituationalWeight)*W[1]+sum(choke$SituationalWeight)*W[2]+sum(null$SituationalWeight)*W[3])
  }
  
  return(score)
}
```

Serving Score Applied to W/B/L D/A/J
```{r}
AppliedScoring<-function(deuce, ad, joint, W=c(1,-1,0) ){
  DW<-servingscore(filter(deuce, deuce$serve.location=="W"))
  DB<-servingscore(filter(deuce, deuce$serve.location=="B"))
  DL<-servingscore(filter(deuce, deuce$serve.location=="L"))
  AW<-servingscore(filter(ad, ad$serve.location=="W"))
  AB<-servingscore(filter(ad, ad$serve.location=="B"))
  AL<-servingscore(filter(ad, ad$serve.location=="L"))
  JW<-servingscore(filter(joint, joint$serve.location=="W"))
  JB<-servingscore(filter(joint, joint$serve.location=="B"))
  JL<-servingscore(filter(joint, joint$serve.location=="L"))
  appliedscores<-c(DW, DB, DL, AL, AB, AW, JL, JB, JW)
  return(appliedscores)
}
```

```{r}
FullMatrix<-function(Dataset){
  #Format the Matrix
  MATRIX<-matrix(data=0,nrow=8,ncol = 9)
  rownames(MATRIX)<-c("Distribution", "First Serve Distribution", "Second Serve Distribution", "Under Pressure %", "Ace Distribution", "Ace Probability", "Short Game Win %", "Double Fault %", "Weighted Clutch Serving Score")
  
  #Make the LP matrix and do the non-clutch column
  LPDataset<-LowPressure(Dataset)
  MATRIX[,1]<-c(servingscore(LPDataset),playscore(LPDataset),clutchscore(LPDataset))
  
  #Then the next 4 columns
  HPDataset<-HighPressure(Dataset)
  MATRIX[,2]<-BYUholdcolumn(HPDataset)
  MATRIX[,3]<-BYUbreakcolumn(HPDataset)
  MATRIX[2:3,4]<-oppholdcolumn(HPDataset)
  MATRIX[2:3,5]<-oppbreakcolumn(HPDataset)
  MATRIX[,6]<-Rawcombo(HPDataset)
  return(MATRIX)
}

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Here's our workspace after all the functions~~~~~~~~~~~~~~~~~~~~~~~~

```{r}
#read it in and separate out just the parts we need
ethantest<-read.csv("Ethan test.csv",header=T)[1:71,]
ethanservingdata<-(cbind(ethantest[,c(11:12,14:16,18:21,22:24)],ethantest[,32]))
ethanservingdata<-as.tbl(ethanservingdata)
ethanservingdata<-filter(ethanservingdata,ethanservingdata$server=="P")
colnames(ethanservingdata)<-c("player.sets","opp.sets","player.games","opp.games","server", "player.points", "opp.points", "serve.result", "serve.location", "return.location", "result", "point.winner", "point.length")
```

```{r}
#now let's try to call all of these functions
ethanservingdata<-pservingonly(ethanservingdata)
ethandaj<-deuceadcreator(ethanservingdata)
  ethandeuce<-as.data.frame(ethandaj[1])
  ethanad<-as.data.frame(ethandaj[2])
  ethanjoint<-as.data.frame(ethandaj[3])
courtdistfunc(ethandeuce,ethanad,ethanjoint)
acedistfunc(ethandeuce,ethanad,ethanjoint)
aceprobfunc(ethandeuce,ethanad,ethanjoint)
shortgamewinperc(ethandeuce,ethanad,ethanjoint)
firstcourtdist(ethandeuce,ethanad,ethanjoint)
secondcourtdist(ethandeuce,ethanad,ethanjoint)
dfperc(ethandeuce,ethanad,ethanjoint)
UnderPressureDistribution(ethandeuce,ethanad,ethanjoint)
AppliedScoring(ethandeuce,ethanad,ethanjoint)
```


```{r}
#Create an example matrix for each player
rawserves<-matrix(0,nrow=1,ncol=8)
as.data.frame(rawserves)
colnames(rawserves)<-c("Player Score","Opponent Score", "F/S/A/D","loc", "Result", "Winner", "Shot Type", "length")
```




```{r}
#calculate and update the distributions
#separate the matrix into a duece and ad court
A<-c(c(1,0),c(0,1),c(3,0),c(0,3),c(1,2),c(2,1),c(3,2),c(2,3))
D<-c(c(0,0),c(2,0),c(0,2),c(1,1),c(2,2),c(3,1),c(1,3))
deucecourtserves<-filter(rawserves,rawserves$sid %in% A|D)
ntotal<-length(totalcleanlocserves)

#"W"|"B"|"L"
```



